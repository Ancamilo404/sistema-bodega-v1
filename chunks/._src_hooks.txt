===== C:\Users\LEO\Desktop\AncamiloProgrm\app-beta-5\src\hooks\useHistorial.ts =====
"use client";

import { useEffect, useState } from "react";
import type { HistorialResponseDTO } from "@/types/historial";

/**
 * Hook para consumir el historial de auditorÃ­a con paginaciÃ³n.
 * Devuelve items, loading, error y controles de pÃ¡gina/lÃ­mite.
 */
export function useHistorial({ limit: initialLimit = 20 }: { limit?: number }) {
  const [items, setItems] = useState<HistorialResponseDTO["items"]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [page, setPage] = useState(1);
  const [limit, setLimit] = useState(initialLimit); // ðŸ‘ˆ ahora es estado

  useEffect(() => {
    setLoading(true);
    (async () => {
      try {
        const res = await fetch(`/api/historial?page=${page}&limit=${limit}`);
        const json = await res.json();

        if (json.error) {
          setError(json.error);
          setItems([]);
        } else {
          setItems(json.data.items);
        }
      } catch (e: any) {
        setError(e.message);
      } finally {
        setLoading(false);
      }
    })();
  }, [page, limit]);

  return {
    items,
    loading,
    error,
    page,
    setPage,
    limit,
    setLimit: (l: number) => {
      setLimit(l);   // ðŸ‘ˆ ahora sÃ­ cambia el lÃ­mite
      setPage(1);    // ðŸ‘ˆ y resetea a la primera pÃ¡gina
    },
  };
}


===== C:\Users\LEO\Desktop\AncamiloProgrm\app-beta-5\src\hooks\useProductos.ts =====
import { useState, useEffect } from "react";

export function useProductos(aliadoId: number | null, pageSize: number = 20) {
  const [items, setItems] = useState<any[]>([]);
  const [page, setPage] = useState(1);
  const [total, setTotal] = useState(0);
  const [loading, setLoading] = useState(false);

  const fetchPage = async (pageNum: number) => {
    if (!aliadoId) return;
    setLoading(true);
    try {
      const res = await fetch(`/api/aliados/${aliadoId}/productos?page=${pageNum}&limit=${pageSize}`);
      const json = await res.json();
      setItems(prev => pageNum === 1 ? json.data.items : [...prev, ...json.data.items]);
      setTotal(json.data.total);
      setPage(pageNum);
    } catch (err) {
      console.error("Error cargando productos:", err);
    } finally {
      setLoading(false);
    }
  };

  // âœ… ARREGLADO: Resetear items cuando cambia el aliado
  useEffect(() => {
    if (aliadoId) {
      setItems([]);     // â¬…ï¸ Limpiar productos anteriores
      setPage(1);       // â¬…ï¸ Resetear pÃ¡gina
      fetchPage(1);
    }
  }, [aliadoId]);

  return {
    items,
    total,
    page,
    loading,
    fetchNext: () => fetchPage(page + 1),
    reset: () => {
      setItems([]);
      fetchPage(1);
    },
  };
}


===== C:\Users\LEO\Desktop\AncamiloProgrm\app-beta-5\src\hooks\useVentas.ts =====
import { useState, useEffect } from "react";

export function useVentas(clienteId: number | null, pageSize: number = 20) {
  const [items, setItems] = useState<any[]>([]);
  const [page, setPage] = useState(1);
  const [total, setTotal] = useState(0);
  const [loading, setLoading] = useState(false);

  const fetchPage = async (pageNum: number) => {
    if (!clienteId) return;
    setLoading(true);
    try {
      const res = await fetch(`/api/clientes/${clienteId}/ventas?page=${pageNum}&limit=${pageSize}`);
      const json = await res.json();
      setItems(prev => pageNum === 1 ? json.data.items : [...prev, ...json.data.items]);
      setTotal(json.data.total);
      setPage(pageNum);
    } catch (err) {
      console.error("Error cargando ventas:", err);
    } finally {
      setLoading(false);
    }
  };

  // âœ… ARREGLADO: Resetear items cuando cambia el cliente
  useEffect(() => {
    if (clienteId) {
      setItems([]);     // â¬…ï¸ Limpiar ventas anteriores
      setPage(1);       // â¬…ï¸ Resetear pÃ¡gina
      fetchPage(1);
    }
  }, [clienteId]);

  return {
    items,
    total,
    page,
    loading,
    fetchNext: () => fetchPage(page + 1),
    reset: () => {
      setItems([]);
      fetchPage(1);
    },
  };
}


